using Mba.Common.MSiMBA;
using Mba.Parsing;
using Mba.Simplifier.Bindings;
using Mba.Simplifier.Minimization;
using Mba.Simplifier.Pipeline;
using Mba.Simplifier.Slgb;
using Mba.Simplifier.Utility;
using Mba.Utility;
using Microsoft.Z3;
using System.ComponentModel;
using System.Diagnostics;

bool printUsage = false;
uint bitWidth = 64;
bool useEqsat = false;
bool proveEquivalence = false;

string inputText = "((((((((((((((((((((((((((~(((((((~(a|b))|(~(((f^(a&d))^c)^a)))|(~(((((a&e)^(b&c))^c)^b)^a)))|((a&c)^c))|((c^e)&(~b)))|(c&(~e)))|(~((((((g^e)^(b&d))^(a&d))^d)^c)^a))))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((a&b)&c)&g)&h)^(((b&c)&g)&h))^(((a&c)&g)&h))^((c&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^((((a&b)&c)&d)&h))^(((a&b)&c)&h))^((b&c)&h))^((a&c)&h))^(c&h))^(((a&c)&f)&g))^((c&f)&g))^(((a&b)&f)&g))^((b&f)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^(((a&b)&c)&g))^((b&c)&g))^((a&c)&g))^(c&g))^((((a&b)&d)&e)&f))^(((b&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((b&c)&e)&f))^((a&e)&f))^(e&f))^((((a&b)&c)&d)&f))^(((b&c)&d)&f))^(((a&c)&d)&f))^((c&d)&f))^(((a&b)&d)&f))^((b&d)&f))^((a&d)&f))^(d&f))^((a&b)&f))^(b&f))^(a&f))^f)^((((a&b)&c)&d)&e))^(((b&c)&d)&e))^(((a&c)&d)&e))^((c&d)&e))^(((a&b)&c)&e))^((b&c)&e))^((a&c)&e))^(c&e))^((a&b)&c))^(b&c))^(a&c))^c))|((((((((((((((((((((((((((((((((((((((((((a&b)&e)&h)^((a&e)&h))^((a&b)&h))^(a&h))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((a&d)&e)&g))^((((a&b)&c)&e)&g))^(((a&c)&e)&g))^((a&e)&g))^(((a&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((a&c)&g))^((a&b)&g))^(a&g))^(((c&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((b&c)&e)&f))^((c&e)&f))^((b&e)&f))^((a&e)&f))^(e&f))^((((a&b)&c)&d)&f))^((c&d)&f))^(((a&b)&d)&f))^(d&f))^((a&c)&f))^(c&f))^(a&f))^f)^((((a&b)&c)&d)&e))^(((a&c)&d)&e))^((a&b)&e))^(a&e))^(a&b))^a))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((((e&f)&h)^(((a&b)&f)&h))^((b&f)&h))^((a&f)&h))^((d&e)&h))^((c&e)&h))^((a&e)&h))^(((b&c)&d)&h))^((b&d)&h))^((a&d)&h))^((b&c)&h))^((a&c)&h))^((a&b)&h))^(a&h))^(((a&d)&f)&g))^((d&f)&g))^(((a&b)&f)&g))^((b&f)&g))^((a&f)&g))^(f&g))^(((c&d)&e)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^((c&e)&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&c)&d)&g))^((a&c)&g))^((((a&b)&d)&e)&f))^(((b&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((a&c)&e)&f))^(((a&b)&e)&f))^((b&e)&f))^(((a&c)&d)&f))^((c&d)&f))^((a&d)&f))^(d&f))^((b&c)&f))^(c&f))^(a&f))^f)^((((a&b)&c)&d)&e))^(((b&c)&d)&e))^((c&d)&e))^((b&d)&e))^((a&d)&e))^(d&e))^((b&c)&e))^((a&b)&e))^(((a&b)&c)&d))^((a&c)&d))^((a&b)&c))^(b&c)))|(~((((~(((f^d)^(a&c))^a))|b)|(e^c))|((g^(a&c))^c))))|((((((((((((((((((((((((((((((b&c)&e)&h)^((c&e)&h))^(((a&b)&c)&h))^((a&c)&h))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((c&d)&e)&g))^(((b&d)&e)&g))^(((b&c)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^(((a&b)&e)&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&b)&d)&g))^((b&d)&g))^((((a&b)&d)&e)&f))^(((b&c)&e)&f))^(((a&c)&e)&f))^((b&e)&f))^(((b&c)&d)&e))^((c&d)&e))^(((a&b)&c)&e))^((a&c)&e))^((a&b)&c))^(a&c)))|(~((((((((((((((((~(c|f))|(a&(~c)))|((((a&d)^d)^(b&c))^b))|((~b)&(a^d)))|((~f)&(a^d)))|((~c)&(b^d)))|((b^g)&a))|((((((((((f&h)^((b&c)&h))^(a&h))^h)^(e&f))^((a&b)&f))^((b&c)&e))^(a&e))^e)^(a&b)))|(((e^h)&(~b))&a))|(~((e^b)|((((g^(b&c))^c)^(a&b))^b))))|((~(e^g))&(~c)))|(~((((((((((((((((((c&e)&h)^((a&e)&h))^((b&c)&h))^(c&h))^((a&e)&f))^(e&f))^((a&b)&f))^(b&f))^(a&f))^f)^(c&e))^((a&b)&e))^(a&e))^e)^(b&c))^c)^b)))|((((((d&g)^((b&c)&e))^(b&e))^d)^(a&b))^a))|((((((((f&g)^(b&g))^g)^((a&b)&f))^((b&c)&e))^(b&e))^(b&c))^b))|(~((h^b)|((((g^(a&e))^e)^(b&c))^c))))|((((((((d&h)^((b&c)&h))^(b&h))^((a&b)&f))^(d&e))^((b&c)&e))^(b&e))^(a&b)))))|(((((((((((((((((((((((((((((((((((((((a&d)&e)&h)^(((a&c)&e)&h))^((a&e)&h))^(((a&b)&d)&h))^((a&d)&h))^(((a&b)&c)&h))^((a&c)&h))^((a&b)&h))^(a&h))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((a&d)&e)&g))^((((a&b)&c)&e)&g))^(((a&c)&e)&g))^((a&e)&g))^(((a&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((a&c)&g))^((a&b)&g))^(a&g))^((((a&b)&d)&e)&f))^(((b&c)&e)&f))^(((a&c)&e)&f))^((b&e)&f))^(((a&c)&d)&e))^((a&d)&e))^((a&c)&e))^(a&e))^((a&b)&d))^(a&d))^((a&b)&c))^(a&c))^(a&b))^a))|((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((d&f)&h)^(((b&c)&f)&h))^(((a&b)&f)&h))^((a&f)&h))^(f&h))^((d&e)&h))^((c&e)&h))^(e&h))^((((a&b)&c)&d)&h))^(((b&c)&d)&h))^(((a&c)&d)&h))^(((a&b)&c)&h))^((a&c)&h))^((a&b)&h))^(a&h))^(((b&d)&f)&g))^(((a&d)&f)&g))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((b&d)&e)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^(((a&b)&e)&g))^((b&e)&g))^((a&e)&g))^(((b&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^(((a&b)&c)&g))^((a&b)&g))^(a&g))^(((b&d)&e)&f))^(((a&d)&e)&f))^(((b&c)&e)&f))^(((a&c)&e)&f))^(((a&b)&e)&f))^((b&e)&f))^((((a&b)&c)&d)&f))^((c&d)&f))^(((a&b)&d)&f))^((b&d)&f))^((a&d)&f))^(d&f))^(((a&b)&c)&f))^((b&c)&f))^((a&c)&f))^(c&f))^((a&b)&f))^(b&f))^(a&f))^f)^(((a&c)&d)&e))^(d&e))^(c&e))^e)^((b&c)&d))^((a&c)&d))^((a&b)&c))^(a&c))^(a&b))^a))|(~((((((((((((((~f)&(~((((b&a)^a)^b)^e)))|((d^(a&b))^b))|(b&(a^c)))|(c&(~(a^e))))|(b&(~g)))|(a&e))|(b&e))|((~((a^g)^h))&((c^g)^h)))|(~(((((((((((((((e&h)^((a&c)&g))^(c&g))^((a&c)&f))^(c&f))^((a&b)&f))^(b&f))^(a&f))^f)^e)^(a&c))^c)^(a&b))^b)^a)))|(((((((((((((b&f)&h)^(f&h))^(b&h))^h)^((c&f)&g))^((a&f)&g))^(c&g))^(a&g))^((a&c)&f))^(c&f))^(a&c))^c))|(((((a&b)&h)^(a&h))^((a&c)&g))^(a&g)))|((h&(~g))&a))|(~(((~((h^(a&c))^c))|f)|g)))))|((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((b&d)&g)&h)^(((a&c)&g)&h))^((c&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^((d&e)&h))^(((a&c)&e)&h))^((b&e)&h))^((a&e)&h))^(e&h))^((((a&b)&c)&d)&h))^(((b&c)&d)&h))^((a&d)&h))^(((a&b)&c)&h))^(c&h))^((e&f)&g))^(((a&c)&f)&g))^((b&f)&g))^(f&g))^(((c&d)&e)&g))^((d&e)&g))^(((a&b)&e)&g))^((a&e)&g))^(((a&c)&d)&g))^((c&d)&g))^((b&d)&g))^(d&g))^((a&c)&g))^(c&g))^((a&b)&g))^(a&g))^(((c&d)&e)&f))^((((a&b)&d)&e)&f))^(((a&d)&e)&f))^(e&f))^(((b&c)&d)&f))^((c&d)&f))^((b&d)&f))^(d&f))^((b&c)&f))^(c&f))^((a&b)&f))^(a&f))^(((a&c)&d)&e))^((c&d)&e))^(((a&b)&d)&e))^((b&d)&e))^(((a&b)&c)&e))^((a&b)&e))^(b&e))^e)^(((a&b)&c)&d))^(c&d))^((a&b)&d))^(b&d))^(a&d))^d)^(a&c))^c)^(a&b))^a))|(((((((((((((((((((((((((((((((((a&d)&g)&h)^(((a&c)&d)&h))^(((a&b)&d)&h))^(((b&d)&f)&g))^((d&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^((a&f)&g))^(f&g))^(((a&d)&e)&g))^(((a&b)&d)&g))^((a&d)&g))^(((c&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((c&e)&f))^((a&e)&f))^(e&f))^((((a&b)&c)&d)&f))^(((b&c)&d)&f))^(((a&b)&d)&f))^((b&d)&f))^(((a&b)&c)&f))^((b&c)&f))^((a&b)&f))^(b&f))^(((a&c)&d)&e))^(((a&b)&d)&e))^(((a&b)&c)&d))^((a&c)&d)))|(~(((((((((((((((((((~b)&(~((a^d)^f)))|((~d)&(b^e)))|((b^e)&a))|((a&c)^c))|((b&c)^c))|(c&(~e)))|(((a&f)^(a&d))^c))|((((a&g)^g)^e)^b))|(c&d))|((b&e)^e))|(~((((((d&f)^f)^(a&d))^d)^c)^a)))|(((((((c&g)^g)^e)^((a&b)&d))^c)^(a&b))^b))|(((((e&f)^e)^((a&b)&d))^c)^(a&b)))|(c&(~f)))|(~(((((((f&g)^g)^f)^(b&d))^d)^(a&b))^a)))|((b&g)^g))|(((d&g)^e)^b))|((((e&g)^g)^e)^b))))|(~(((((~f)|a)|c)|d)|e)))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((c&d)&e)&h)^((((a&b)&c)&d)&h))^(((a&c)&d)&h))^((e&f)&g))^(((a&d)&f)&g))^((d&f)&g))^(((a&c)&f)&g))^((c&f)&g))^(((a&b)&f)&g))^((a&f)&g))^((d&e)&g))^(((b&c)&e)&g))^((a&e)&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&c)&d)&g))^((c&d)&g))^(((a&b)&d)&g))^(d&g))^(((a&b)&c)&g))^((b&c)&g))^((a&b)&g))^(a&g))^((((a&b)&d)&e)&f))^((((a&b)&c)&e)&f))^(((b&c)&e)&f))^((c&e)&f))^((b&e)&f))^(e&f))^(((a&c)&d)&f))^((c&d)&f))^((a&d)&f))^(d&f))^((b&c)&f))^((a&c)&f))^(b&f))^(a&f))^((b&d)&e))^(d&e))^(((a&b)&c)&e))^((a&c)&e))^((a&b)&e))^(a&e))^(((a&b)&c)&d))^((b&c)&d))^((a&c)&d))^(c&d))^(b&d))^d)^((a&b)&c))^(a&c))^(a&b))^a))|(~(((((~b)|(~f))|(c^a))|(e^a))|d)))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((e&g)&h)^(((b&c)&g)&h))^(((a&c)&g)&h))^((c&g)&h))^(((a&b)&g)&h))^((a&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^(((a&c)&e)&h))^((b&e)&h))^((((a&b)&c)&d)&h))^((b&c)&h))^(c&h))^(((a&d)&f)&g))^((d&f)&g))^(((b&c)&f)&g))^(((a&c)&f)&g))^((c&f)&g))^((a&f)&g))^(f&g))^(((a&d)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^((a&e)&g))^(e&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((a&c)&g))^(c&g))^(((c&d)&e)&f))^(((a&d)&e)&f))^((((a&b)&c)&e)&f))^(((a&c)&e)&f))^((c&e)&f))^(((a&b)&e)&f))^(((b&c)&d)&f))^(((a&c)&d)&f))^((b&d)&f))^((a&d)&f))^((a&c)&f))^(c&f))^((a&b)&f))^(b&f))^(((a&c)&d)&e))^((c&d)&e))^(((a&b)&c)&e))^((b&c)&e))^(c&e))^(b&e))^(b&c))^c))|(~(((((((((~((e^b)^a))|(~(((((((d&f)^f)^d)^((a&b)&c))^(b&c))^(a&b))^a)))|((g^d)^c))|((b&d)^d))|(a&d))|(c&d))|((~b)&(~(a^f))))|((b^f)&a))|(c&(~((a^b)^f))))))|(~(((((~f)|a)|b)|d)|(g^c))))|((((b&(~a))&f)&(~c))&(g^e)))|(~((((((((~a)|(~b))|(~(c|e)))|(~(e|g)))|d)|((~(f^g))&(~c)))|((~f)&(~(c^e))))|(~(f|g)))))|(((f&(~(c^a)))&(~d))&(g^e)))|((((a&c)&g)&(~d))&(~e)))|(~((((((((~b)|(~(d^a)))|(e^a))|((a&c)^c))|(~(a|g)))|(~(((c&g)^g)^(a&f))))|(c&(~f)))|(~(f|g)))))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((f&g)&h)^((d&g)&h))^(((b&c)&g)&h))^((c&g)&h))^(((a&b)&g)&h))^((a&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^(f&h))^(((a&c)&d)&h))^(((a&b)&d)&h))^((a&d)&h))^(d&h))^((b&c)&h))^(c&h))^((a&b)&h))^(a&h))^((e&f)&g))^((b&f)&g))^((a&f)&g))^(((a&d)&e)&g))^((d&e)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^((a&e)&g))^((c&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((b&c)&g))^((a&c)&g))^(c&g))^((a&b)&g))^(a&g))^(((b&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((a&c)&e)&f))^((c&e)&f))^(((a&b)&e)&f))^((a&e)&f))^((((a&b)&c)&d)&f))^(((a&c)&d)&f))^((b&d)&f))^(d&f))^(((a&b)&c)&f))^((b&c)&f))^(b&f))^f)^((((a&b)&c)&d)&e))^(d&e))^((b&c)&e))^(c&e))^((a&b)&e))^(a&e))^(((a&b)&c)&d))^(c&d))^(b&c))^c)^(a&b))^a))|((((a&b)&c)&(f^d))&h))";

inputText = "343";

inputText = "2284837645 + 272908530*a + 136454265*b + 409362795*x + 135832444*c + 4159134852*d + 415760384*a*a + 415760384*a*b + 1247281152*a*x + 2816475136*a*c + 1478492160*a*d + 3325165568*b*b + 2771124224*b*x + 1408237568*b*c + 2886729728*b*d + 4156686336*x*x + 4224712704*x*c + 70254592*x*d + 1428160512*c*c + 1438646272*c*d + 1428160512*d*d";
inputText = "2284837645 + 272908530*x*a + 136454265*x*b + 409362795*x + 135832444*c + 4159134852*d + 415760384*x*a*x*a + 415760384*x*a*x*b + 1247281152*x*a*x + 2816475136*x*a*c + 1478492160*x*a*d + 3325165568*x*b*x*b + 2771124224*x*b*x + 1408237568*x*b*c + 2886729728*x*b*d + 4156686336*x*x + 4224712704*x*c + 70254592*x*d + 1428160512*c*c + 1438646272*c*d + 1428160512*d*d";


inputText = "(((((((((((((((((((((((((((((((((((((((((((((~a)&b)&(~d))&(~e))&f)&(~g))&(~h))|(((((((a&(~b))&(~c))&d)&e)&(~f))&g)&h))|((((((~a)&(~b))&c)&d)&e)&(~h)))|(((((((~a)&(~b))&c)&(~d))&e)&(~g))&h))|(((((((~a)&b)&(~d))&e)&(~f))&(~g))&(~h)))|(((((((~a)&c)&d)&e)&f)&g)&(~h)))|(((((((~a)&c)&d)&e)&(~f))&g)&h))|((((((a&b)&c)&d)&e)&(~f))&g))|(((((((~a)&(~c))&d)&(~e))&(~f))&(~g))&h))|((((((a&(~b))&(~c))&(~d))&(~f))&(~g))&h))|(((((a&b)&(~c))&(~d))&e)&(~h)))|((((((b&(~c))&(~d))&e)&(~f))&g)&h))|((((((~a)&(~b))&c)&(~d))&f)&g))|((((((a&b)&d)&(~e))&(~f))&(~g))&h))|((((((a&b)&c)&(~e))&f)&g)&(~h)))|((((((~b)&c)&(~e))&f)&g)&h))|(((((a&(~b))&d)&(~e))&(~f))&(~h)))|((((a&c)&(~d))&(~e))&g))|(((((a&c)&(~d))&e)&f)&(~g)))|(((((a&b)&c)&e)&f)&h))|(((((a&c)&d)&e)&(~g))&h))|(((((b&c)&d)&e)&(~g))&h))|(((((a&(~c))&d)&(~e))&f)&h))|((((((~a)&b)&(~c))&d)&(~e))&g))|((((((~a)&(~c))&(~d))&e)&(~g))&(~h)))|(((((a&b)&(~d))&(~e))&f)&h))|((((b&(~c))&e)&(~g))&(~h)))|((((((~a)&c)&(~e))&(~f))&(~g))&(~h)))|(((((a&(~b))&(~d))&(~e))&g)&h))|(((((b&c)&(~d))&(~e))&(~f))&g))|(((((a&b)&(~d))&e)&f)&(~h)))|((((((~a)&(~b))&e)&(~f))&g)&(~h)))|((((((~b)&d)&e)&f)&g)&(~h)))|(((((b&c)&d)&(~f))&g)&h))|(((((~a)&(~c))&(~d))&(~e))&f))|(((((~a)&(~b))&(~d))&f)&h))|((((a&(~b))&(~e))&(~g))&(~h)))|((((b&e)&f)&(~g))&h))|(((((~b)&d)&(~f))&(~g))&(~h)))";

inputText = "x0|x1|x2|x3^(x4|x5|x6&x7)^(x1&x2&x3&x4&x8&x9^(x3|x8|x9))^(~(x10|x2&x3|x4&x6&x8^x9&x10&x11))|(x1^x2^x3)";

inputText = "x3^(x4|x5|x6&x7)^(x1&x2&x3&x4&x8&x9^(x3|x8|x9))^(~(x10|x2&x3|x4&x6&x8^x9&x10&x11))";

inputText = "a|b|c";

inputText = "x3^(x4|x5|x6&x7)^(x1&x2&x3&x4&x8&x9^(x3|x8|x9))^(~(x10|x2&x3|x4&x6&x8^x9&x10&x11))";

inputText = "x0|x1|x2|x3^(x4|x5|x6&x7)^(x1&x2&x3&x4&x8&x9^(x3|x8|x9))^(~(x10|x2&x3|x4&x6&x8^x9&x10&x11))|(x1^x2^x3)";

inputText = "(a|b|c)^d";

inputText = "x3^(x4|x5|x6&x7)^(x1&x2&x3&x4&x8&x9^(x3|x8|x9))^(~(x10|x2&x3|x4&x6&x8^x9&x10&x11))";

inputText = "(x1&(x9&(-1^((((((x6&x7)^(x5&(-1^(x6&x7))))^(x4&(-1^(((x6&x7)^(x5&(-1^(x6&x7))))^(x8&(x3^x10))))))^x3)^(x2&(-1^(((((x6&x7)^(x5&(-1^(x6&x7))))^(x4&(-1^((x6&x7)^(x5&(-1^(x6&x7)))))))^x3)^x10))))^x10))))";

inputText = "(x1&((((x2&x4)&x6)&x8)&x9))|(x1&(x2&(x3&(x8&(x9&(-1^(x6^(x5&(-1^x6)))))))))";

inputText = "(x1&(x9&(-1^((((((x6&x7)^(x5&(-1^(x6&x7))))^(x4&(-1^(((x6&x7)^(x5&(-1^(x6&x7))))^(x8&(x3^x10))))))^x3)^(x2&(-1^(((((x6&x7)^(x5&(-1^(x6&x7))))^(x4&(-1^((x6&x7)^(x5&(-1^(x6&x7)))))))^x3)^x10))))^x10))))|(x1&(x8&(x9&(-1^(((((x6&(-1^((x4^x3)^x10)))^(x5&(-1^((((x6&(-1^((x4^x3)^x10)))^x4)^x3)^x10))))^x4)^x3)^x10)))))|(x1&(x2&(x3&(x8&(x9&(-1^(x7^(x5&(-1^x7)))))))))|(x1&(x4&(x8&(x9&((x6^x3)^(x10&(-1^x6)))))))|(x1&((((x2&x3)&x4)&x8)&x9))|(x1&(x2&(x3&(x8&(x9&(-1^(x6^(x5&(-1^x6)))))))))|(x1&((((x2&x4)&x6)&x8)&x9))";

inputText = "((((((x8&x6)&x4)|(~(x10^x4)))^(((x7&x6)&(~x4))|(x5&(~x4))))^x3)^(x2&((((((~x6)&(~x5))&(~x4))|(((~x7)&(~x5))&(~x4)))^(x8&(((((x4&x10)|(x4&x3))|((~x5)&(~(x10^x4))))|((~x5)&x3))^(x6&((((~x5)&(~x4))&(~x10))^(x3&(((~x5)&(~(((x7&x4)^x10)^x7)))|(x4&(~x10)))))))))^(x10^x3))))";

inputText = "(x2&(x8&((x4&(x6&(-1^x5)))^(x3&(-1^((x6^(x5&(-1^(x6^x4))))^x4))))))";

inputText = "x0|x1|x2|x3^(x4|x5|x6&x7)^(x1&x2&x3&x4&x8&x9^(x3|x8|x9))^(~(x10|x2&x3|x4&x6&x8^x9&x10&x11))|(x1^x2^x3)";

//SlgbTesting.Run();

inputText = "((((((((((((((((((((((((((~(((((((~(a|b))|(~(((f^(a&d))^c)^a)))|(~(((((a&e)^(b&c))^c)^b)^a)))|((a&c)^c))|((c^e)&(~b)))|(c&(~e)))|(~((((((g^e)^(b&d))^(a&d))^d)^c)^a))))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((a&b)&c)&g)&h)^(((b&c)&g)&h))^(((a&c)&g)&h))^((c&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^((((a&b)&c)&d)&h))^(((a&b)&c)&h))^((b&c)&h))^((a&c)&h))^(c&h))^(((a&c)&f)&g))^((c&f)&g))^(((a&b)&f)&g))^((b&f)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^(((a&b)&c)&g))^((b&c)&g))^((a&c)&g))^(c&g))^((((a&b)&d)&e)&f))^(((b&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((b&c)&e)&f))^((a&e)&f))^(e&f))^((((a&b)&c)&d)&f))^(((b&c)&d)&f))^(((a&c)&d)&f))^((c&d)&f))^(((a&b)&d)&f))^((b&d)&f))^((a&d)&f))^(d&f))^((a&b)&f))^(b&f))^(a&f))^f)^((((a&b)&c)&d)&e))^(((b&c)&d)&e))^(((a&c)&d)&e))^((c&d)&e))^(((a&b)&c)&e))^((b&c)&e))^((a&c)&e))^(c&e))^((a&b)&c))^(b&c))^(a&c))^c))|((((((((((((((((((((((((((((((((((((((((((a&b)&e)&h)^((a&e)&h))^((a&b)&h))^(a&h))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((a&d)&e)&g))^((((a&b)&c)&e)&g))^(((a&c)&e)&g))^((a&e)&g))^(((a&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((a&c)&g))^((a&b)&g))^(a&g))^(((c&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((b&c)&e)&f))^((c&e)&f))^((b&e)&f))^((a&e)&f))^(e&f))^((((a&b)&c)&d)&f))^((c&d)&f))^(((a&b)&d)&f))^(d&f))^((a&c)&f))^(c&f))^(a&f))^f)^((((a&b)&c)&d)&e))^(((a&c)&d)&e))^((a&b)&e))^(a&e))^(a&b))^a))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((((e&f)&h)^(((a&b)&f)&h))^((b&f)&h))^((a&f)&h))^((d&e)&h))^((c&e)&h))^((a&e)&h))^(((b&c)&d)&h))^((b&d)&h))^((a&d)&h))^((b&c)&h))^((a&c)&h))^((a&b)&h))^(a&h))^(((a&d)&f)&g))^((d&f)&g))^(((a&b)&f)&g))^((b&f)&g))^((a&f)&g))^(f&g))^(((c&d)&e)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^((c&e)&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&c)&d)&g))^((a&c)&g))^((((a&b)&d)&e)&f))^(((b&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((a&c)&e)&f))^(((a&b)&e)&f))^((b&e)&f))^(((a&c)&d)&f))^((c&d)&f))^((a&d)&f))^(d&f))^((b&c)&f))^(c&f))^(a&f))^f)^((((a&b)&c)&d)&e))^(((b&c)&d)&e))^((c&d)&e))^((b&d)&e))^((a&d)&e))^(d&e))^((b&c)&e))^((a&b)&e))^(((a&b)&c)&d))^((a&c)&d))^((a&b)&c))^(b&c)))|(~((((~(((f^d)^(a&c))^a))|b)|(e^c))|((g^(a&c))^c))))|((((((((((((((((((((((((((((((b&c)&e)&h)^((c&e)&h))^(((a&b)&c)&h))^((a&c)&h))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((c&d)&e)&g))^(((b&d)&e)&g))^(((b&c)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^(((a&b)&e)&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&b)&d)&g))^((b&d)&g))^((((a&b)&d)&e)&f))^(((b&c)&e)&f))^(((a&c)&e)&f))^((b&e)&f))^(((b&c)&d)&e))^((c&d)&e))^(((a&b)&c)&e))^((a&c)&e))^((a&b)&c))^(a&c)))|(~((((((((((((((((~(c|f))|(a&(~c)))|((((a&d)^d)^(b&c))^b))|((~b)&(a^d)))|((~f)&(a^d)))|((~c)&(b^d)))|((b^g)&a))|((((((((((f&h)^((b&c)&h))^(a&h))^h)^(e&f))^((a&b)&f))^((b&c)&e))^(a&e))^e)^(a&b)))|(((e^h)&(~b))&a))|(~((e^b)|((((g^(b&c))^c)^(a&b))^b))))|((~(e^g))&(~c)))|(~((((((((((((((((((c&e)&h)^((a&e)&h))^((b&c)&h))^(c&h))^((a&e)&f))^(e&f))^((a&b)&f))^(b&f))^(a&f))^f)^(c&e))^((a&b)&e))^(a&e))^e)^(b&c))^c)^b)))|((((((d&g)^((b&c)&e))^(b&e))^d)^(a&b))^a))|((((((((f&g)^(b&g))^g)^((a&b)&f))^((b&c)&e))^(b&e))^(b&c))^b))|(~((h^b)|((((g^(a&e))^e)^(b&c))^c))))|((((((((d&h)^((b&c)&h))^(b&h))^((a&b)&f))^(d&e))^((b&c)&e))^(b&e))^(a&b)))))|(((((((((((((((((((((((((((((((((((((((a&d)&e)&h)^(((a&c)&e)&h))^((a&e)&h))^(((a&b)&d)&h))^((a&d)&h))^(((a&b)&c)&h))^((a&c)&h))^((a&b)&h))^(a&h))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((a&d)&e)&g))^((((a&b)&c)&e)&g))^(((a&c)&e)&g))^((a&e)&g))^(((a&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((a&c)&g))^((a&b)&g))^(a&g))^((((a&b)&d)&e)&f))^(((b&c)&e)&f))^(((a&c)&e)&f))^((b&e)&f))^(((a&c)&d)&e))^((a&d)&e))^((a&c)&e))^(a&e))^((a&b)&d))^(a&d))^((a&b)&c))^(a&c))^(a&b))^a))|((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((d&f)&h)^(((b&c)&f)&h))^(((a&b)&f)&h))^((a&f)&h))^(f&h))^((d&e)&h))^((c&e)&h))^(e&h))^((((a&b)&c)&d)&h))^(((b&c)&d)&h))^(((a&c)&d)&h))^(((a&b)&c)&h))^((a&c)&h))^((a&b)&h))^(a&h))^(((b&d)&f)&g))^(((a&d)&f)&g))^(((b&c)&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^(((b&d)&e)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^(((a&b)&e)&g))^((b&e)&g))^((a&e)&g))^(((b&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^(((a&b)&c)&g))^((a&b)&g))^(a&g))^(((b&d)&e)&f))^(((a&d)&e)&f))^(((b&c)&e)&f))^(((a&c)&e)&f))^(((a&b)&e)&f))^((b&e)&f))^((((a&b)&c)&d)&f))^((c&d)&f))^(((a&b)&d)&f))^((b&d)&f))^((a&d)&f))^(d&f))^(((a&b)&c)&f))^((b&c)&f))^((a&c)&f))^(c&f))^((a&b)&f))^(b&f))^(a&f))^f)^(((a&c)&d)&e))^(d&e))^(c&e))^e)^((b&c)&d))^((a&c)&d))^((a&b)&c))^(a&c))^(a&b))^a))|(~((((((((((((((~f)&(~((((b&a)^a)^b)^e)))|((d^(a&b))^b))|(b&(a^c)))|(c&(~(a^e))))|(b&(~g)))|(a&e))|(b&e))|((~((a^g)^h))&((c^g)^h)))|(~(((((((((((((((e&h)^((a&c)&g))^(c&g))^((a&c)&f))^(c&f))^((a&b)&f))^(b&f))^(a&f))^f)^e)^(a&c))^c)^(a&b))^b)^a)))|(((((((((((((b&f)&h)^(f&h))^(b&h))^h)^((c&f)&g))^((a&f)&g))^(c&g))^(a&g))^((a&c)&f))^(c&f))^(a&c))^c))|(((((a&b)&h)^(a&h))^((a&c)&g))^(a&g)))|((h&(~g))&a))|(~(((~((h^(a&c))^c))|f)|g)))))|((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((b&d)&g)&h)^(((a&c)&g)&h))^((c&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^((d&e)&h))^(((a&c)&e)&h))^((b&e)&h))^((a&e)&h))^(e&h))^((((a&b)&c)&d)&h))^(((b&c)&d)&h))^((a&d)&h))^(((a&b)&c)&h))^(c&h))^((e&f)&g))^(((a&c)&f)&g))^((b&f)&g))^(f&g))^(((c&d)&e)&g))^((d&e)&g))^(((a&b)&e)&g))^((a&e)&g))^(((a&c)&d)&g))^((c&d)&g))^((b&d)&g))^(d&g))^((a&c)&g))^(c&g))^((a&b)&g))^(a&g))^(((c&d)&e)&f))^((((a&b)&d)&e)&f))^(((a&d)&e)&f))^(e&f))^(((b&c)&d)&f))^((c&d)&f))^((b&d)&f))^(d&f))^((b&c)&f))^(c&f))^((a&b)&f))^(a&f))^(((a&c)&d)&e))^((c&d)&e))^(((a&b)&d)&e))^((b&d)&e))^(((a&b)&c)&e))^((a&b)&e))^(b&e))^e)^(((a&b)&c)&d))^(c&d))^((a&b)&d))^(b&d))^(a&d))^d)^(a&c))^c)^(a&b))^a))|(((((((((((((((((((((((((((((((((a&d)&g)&h)^(((a&c)&d)&h))^(((a&b)&d)&h))^(((b&d)&f)&g))^((d&f)&g))^(((a&c)&f)&g))^(((a&b)&f)&g))^((b&f)&g))^((a&f)&g))^(f&g))^(((a&d)&e)&g))^(((a&b)&d)&g))^((a&d)&g))^(((c&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((c&e)&f))^((a&e)&f))^(e&f))^((((a&b)&c)&d)&f))^(((b&c)&d)&f))^(((a&b)&d)&f))^((b&d)&f))^(((a&b)&c)&f))^((b&c)&f))^((a&b)&f))^(b&f))^(((a&c)&d)&e))^(((a&b)&d)&e))^(((a&b)&c)&d))^((a&c)&d)))|(~(((((((((((((((((((~b)&(~((a^d)^f)))|((~d)&(b^e)))|((b^e)&a))|((a&c)^c))|((b&c)^c))|(c&(~e)))|(((a&f)^(a&d))^c))|((((a&g)^g)^e)^b))|(c&d))|((b&e)^e))|(~((((((d&f)^f)^(a&d))^d)^c)^a)))|(((((((c&g)^g)^e)^((a&b)&d))^c)^(a&b))^b))|(((((e&f)^e)^((a&b)&d))^c)^(a&b)))|(c&(~f)))|(~(((((((f&g)^g)^f)^(b&d))^d)^(a&b))^a)))|((b&g)^g))|(((d&g)^e)^b))|((((e&g)^g)^e)^b))))|(~(((((~f)|a)|c)|d)|e)))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((c&d)&e)&h)^((((a&b)&c)&d)&h))^(((a&c)&d)&h))^((e&f)&g))^(((a&d)&f)&g))^((d&f)&g))^(((a&c)&f)&g))^((c&f)&g))^(((a&b)&f)&g))^((a&f)&g))^((d&e)&g))^(((b&c)&e)&g))^((a&e)&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&c)&d)&g))^((c&d)&g))^(((a&b)&d)&g))^(d&g))^(((a&b)&c)&g))^((b&c)&g))^((a&b)&g))^(a&g))^((((a&b)&d)&e)&f))^((((a&b)&c)&e)&f))^(((b&c)&e)&f))^((c&e)&f))^((b&e)&f))^(e&f))^(((a&c)&d)&f))^((c&d)&f))^((a&d)&f))^(d&f))^((b&c)&f))^((a&c)&f))^(b&f))^(a&f))^((b&d)&e))^(d&e))^(((a&b)&c)&e))^((a&c)&e))^((a&b)&e))^(a&e))^(((a&b)&c)&d))^((b&c)&d))^((a&c)&d))^(c&d))^(b&d))^d)^((a&b)&c))^(a&c))^(a&b))^a))|(~(((((~b)|(~f))|(c^a))|(e^a))|d)))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((e&g)&h)^(((b&c)&g)&h))^(((a&c)&g)&h))^((c&g)&h))^(((a&b)&g)&h))^((a&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^(((a&c)&e)&h))^((b&e)&h))^((((a&b)&c)&d)&h))^((b&c)&h))^(c&h))^(((a&d)&f)&g))^((d&f)&g))^(((b&c)&f)&g))^(((a&c)&f)&g))^((c&f)&g))^((a&f)&g))^(f&g))^(((a&d)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^((a&e)&g))^(e&g))^((((a&b)&c)&d)&g))^(((b&c)&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((a&c)&g))^(c&g))^(((c&d)&e)&f))^(((a&d)&e)&f))^((((a&b)&c)&e)&f))^(((a&c)&e)&f))^((c&e)&f))^(((a&b)&e)&f))^(((b&c)&d)&f))^(((a&c)&d)&f))^((b&d)&f))^((a&d)&f))^((a&c)&f))^(c&f))^((a&b)&f))^(b&f))^(((a&c)&d)&e))^((c&d)&e))^(((a&b)&c)&e))^((b&c)&e))^(c&e))^(b&e))^(b&c))^c))|(~(((((((((~((e^b)^a))|(~(((((((d&f)^f)^d)^((a&b)&c))^(b&c))^(a&b))^a)))|((g^d)^c))|((b&d)^d))|(a&d))|(c&d))|((~b)&(~(a^f))))|((b^f)&a))|(c&(~((a^b)^f))))))|(~(((((~f)|a)|b)|d)|(g^c))))|((((b&(~a))&f)&(~c))&(g^e)))|(~((((((((~a)|(~b))|(~(c|e)))|(~(e|g)))|d)|((~(f^g))&(~c)))|((~f)&(~(c^e))))|(~(f|g)))))|(((f&(~(c^a)))&(~d))&(g^e)))|((((a&c)&g)&(~d))&(~e)))|(~((((((((~b)|(~(d^a)))|(e^a))|((a&c)^c))|(~(a|g)))|(~(((c&g)^g)^(a&f))))|(c&(~f)))|(~(f|g)))))|(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((f&g)&h)^((d&g)&h))^(((b&c)&g)&h))^((c&g)&h))^(((a&b)&g)&h))^((a&g)&h))^(((b&c)&f)&h))^(((a&c)&f)&h))^((c&f)&h))^(f&h))^(((a&c)&d)&h))^(((a&b)&d)&h))^((a&d)&h))^(d&h))^((b&c)&h))^(c&h))^((a&b)&h))^(a&h))^((e&f)&g))^((b&f)&g))^((a&f)&g))^(((a&d)&e)&g))^((d&e)&g))^((((a&b)&c)&e)&g))^(((b&c)&e)&g))^(((a&c)&e)&g))^((c&e)&g))^((a&e)&g))^((c&d)&g))^(((a&b)&d)&g))^((a&d)&g))^((b&c)&g))^((a&c)&g))^(c&g))^((a&b)&g))^(a&g))^(((b&d)&e)&f))^(((a&d)&e)&f))^((d&e)&f))^((((a&b)&c)&e)&f))^(((a&c)&e)&f))^((c&e)&f))^(((a&b)&e)&f))^((a&e)&f))^((((a&b)&c)&d)&f))^(((a&c)&d)&f))^((b&d)&f))^(d&f))^(((a&b)&c)&f))^((b&c)&f))^(b&f))^f)^((((a&b)&c)&d)&e))^(d&e))^((b&c)&e))^(c&e))^((a&b)&e))^(a&e))^(((a&b)&c)&d))^(c&d))^(b&c))^c)^(a&b))^a))|((((a&b)&c)&(f^d))&h))";


inputText = "((((((((((((((((((((((((((((((((((x1)&(x0))|((x0&(x3))^((x2)^x5)))|((x1&(x2))^((x0&(x4))^(x2))))|(x2&(x0)))|((((x2)^x4)|x1)^1))|(x2&(x4)))|((x3&((x0)^x1))^((((x0)^x2)^x4)^x6)))^1)|((x2&((x1&((x0&((x4&(((x3)^x5)^x6))^((x7&((x3)^x6))^(((x3&x5))^x6))))^((x4&(((x3)^x5)^x6))^((x7&((x5)^x6))^(((x3&x5))^x6)))))^((x0)&((x6&(((x4)^x5)^x7))^((x7&(x5))^((x4&(x3))^((x3&x5))))))))^(x5&((x1&((x3&((x4)&(x0)))^((x0)&(x6))))^((x4)&((x3)&(x0)))))))|((x0&((x4&((x1&((x2&((x3^x5)^x6))^(x7)))^((x6&((x2)^x3))^((((x2&x3))^x5)^x7))))^((x6&((x1&((x3)^x5))^((x2&((x3)^x5))^(x3))))^((x1&(((x3&x5)&(x2))^(x7)))^((x5&(x2))^(x7))))))^(x5&((x4&((x2)&((x1)^x3)))^((x2)&((x3)^(x1&x6)))))))|((x0&((x5&((x4&((x1&((x2)^x3))^(x2^x3)))^((x3&((x2)^x6))^((x7&(x1))^((x6&(x1)))))))^((x2&((x1&((x3&((x4)^x6))^((x4&x6))))^((x3&(x6))^(x6^x7))))^((x7&(((x1)^x3)^x4))^(x4&(x1^x3))))))^((x4&((x3&((x1&((x2)^x5))^((x2&(x6))^((x5)^x7))))^((x2&((x1&(x6))^(x6^x7)))^(x5&(x1^x7)))))^((x5&((x1&((x2^x6)^x7))^((x3)&((x2)^x6))))^(x1&((x2&((x7&(x3))^((x3&x6))))^(x3&x7)))))))|((((((x0&(x2))^((x3)^x5))|x1)|(x2^x4))|((x2&(x0))^x6))^1))|((x2&((x4&((x1&((((x0^x3)^x5)^x6)^x7))^((x0&((x5)^x6))^((x3&(x6))^(x6^x7)))))^((x0&((x1&(((x3&x6))^x7))^(((x5&x6))^x7)))^((x1&x6)&(x3^x5)))))^(x1&((x6&((x3&((x0)^x4))^((x0&(x4^x5))^x5)))^((x4&x5)&((x0&x3)))))))|((x2&((x1&((x0&((x3&((x5)^x7))^((x4&(x5))^(x5^x6))))^((x5&(((x3)^x4)^x6))^((x4&(x3))^(x6&(x3))))))^((x6&((x7&((x0)^x3))^((x4)&((x0)^x3))))^((x3&((x5&(x0))^((x4)^x7)))^((x0)&(((x4)^x5)^x7))))))^(x5&((x4&((x0)&((x1)^x3)))^(x6&((x0)&((x1)^x3)))))))|((x0&((x4&((x2&((x6&(x1))^(((x3)^x5)^x7)))^((x3&((((x1&x5))^x6)^x7))^((x6)^x7))))^((x1&((x7&((x2)^x3))^((x6&((x3)^x5))^((x2)^x3))))^((x2&((x6&((x3)^x5))^(x7)))^((x3)&((x6)^x7))))))^((x1&x5)&((x4&(x2))^(x6&(x2))))))|((x0&((x1&((x2&((x7&(x3))^(((x5&(x3))^(x6&(x4))))))^((x5&((((x3)^x4)^x6)^x7))^((x6&((x3)^x4))^(x7)))))^((x2&(((x3&((x4)^x7))^(x5&((x4)^x6)))^(x7)))^((x5&((x3&((x4)^x6))^(x7)))^((x6&((x3)^x4))^(x7))))))^((x1&((x5&((x2&(((x4)^x6)^x7))^((x3)&((x4)^x6))))^((x2&((x3&((x6)^x7))^(x4&x6)))^((x4&x6)&(x3)))))^((x4&((x7)&((x2)^x3)))^(x5&((x3)&((x2)^x7)))))))|((x0&((x1&((x2&((x4&((x3)^x6))^((x3&(x5^x6))^x5)))^((x3&((x5)^x7))^((x6&(x4))^((x5)^x7)))))^((x3)&((x2&((x4^x5)^x6))^((x6&(x4))^((x5)^x7))))))^((x4&((x1&((x3&(((x2)^x6)^x7))^((x2&(x6))^(x7))))^((x2&((x3)&(x6)))^((x7)&(x3)))))^((x5&((x1)&((x2)&(x3))))^(((x1&x3)&x6)&(x2))))))|((x2&((x3&((x4&(((x0)^x5)^x6))^((x1&((x7&(x0))^(x0^x5)))^((x6&(x0))^(x5)))))^((x7&((x0&(((x1^x4)^x5)^x6))^((x5&(x1))^(x6))))^((x0&((x6&(x5))^((x1&x4))))^((x5&(x1))^(x6))))))^((x4&((x1&((x0&((x3&(x5))^(x6)))^((x3)^x7)))^((x7&((x0)^x3))^((x5&(((x0&x3))^x6))^((x6&(x0^x3)))))))^((x3&((x1&((x6&(x7))^((x0)^x5)))^((x0&(x7))^((x5)^x6))))^((x0&((x1)&((x5)^x6)))^((x5&x6)&(x1)))))))|((x5&((x1&((x3&((x2&(x0))^((x0)^x6)))^((x0)&((x2)^x6))))^((x4&((x3)&((x0)^x2)))^(x6&((x0&(x2))^(x3))))))^((x3&x0)&((x1&(((x2^x4)^x6)^x7))^((x2&((x4)^x7))^(x6&((x4)^x7)))))))|((x2&((x6&((x0&((x1&(x3))^(x4)))^((x5&((x1)^x4))^(x3&(x4)))))^((x4&((x1&(x0^x3))^((x0^x3)^x5)))^((x1)&((x0^x3)^x5)))))^((x4&((x0&((x1&((x5&(x3))))^(x6)))^((x3&((x1)^x6))^(x5&(x6)))))^((x1&((x0&((x6&(x3))))^((x5&(x6))^x3)))^((x6)&((x0^x3)^x5))))))|((((((x5)|x0)|x2)|x3)|x4)^1))|((x0&((x2&((x1&((x3&((x6)^x7))^((x4&(x5))^(x6))))^((x3&(((x5)^x6)^x7))^((x5&(x6))^(x4)))))^((x6&((x1&((x3)^x5))^((x5&(x3))^(x4))))^((x4&((x1&((x3&x5)))))^((x5&(x3))^(x1))))))^((x3&((x2&((x1&(x6))^(((x5)^x6)^(x4&x7))))^((x4&((x1)^x6))^((x5&(x6))^((x1)^x6)))))^((x5&((x4&((x1&(x2))^((x2)^x6)))^((x1&(x2))^(x2&x6))))^(((x1&x2)&x6)&(x4))))))|((((((x1)|(x5))|(x0^x2))|(x0^x4))|x3)^1))|((x2&((x0&((x4&((x1&(x5))^(((x3^x5)^x6)^x7)))^((x5&(((x3)^x6)^x7))^((x6&(((x1&x3))^x7))^((x1&x3)&x7)))))^((x1&((x7&((x5)^x6))^((x3&(x5^x6))^((x4)^(x5&x6)))))^((x4&((x3&(x5))^((x5)^x6)))^((x7&((x5)^x6))^((x5)&(x6)))))))^((x0&((x6&((x3&(((x1)^x4)^x5))^((x7&(x1))^(x4^x5))))^(x5&((x4)&(x1^x3)))))^((x4&((x7)&(x1^x6)))^(x5&((x1&(x3))^(x6&(x3))))))))|((((((((((((x0)^x1)^x4)|((x1&((x2&(x0))^x0))^((x3&(x5))^((x0)^x5))))|((x2^x3)^x6))|(x3&(x1)))|(x0&x3))|(x2&x3))|((x1)&((x0)^x5)))|(x0&(x1^x5)))|(x2&(((x0)^x1)^x5)))^1))|((((((x5)|x0)|x1)|x3)|(x2^x6))^1))|((((((x1)|x0)|(x5))|x2)|((x4)^x6))^1))|((x1&x0)&((x4&((x3)&(x5^x6)))^((x2&x6)&(x3)))))|(((((x5)|(x0^x2))|x3)|((x4)^x6))^1))|(((x2&x0)&x6)&((x4)&(x3))))|(x1&((x6&((x3&((x2)&((x0)^x4)))^((x4&x0)&(x2))))^(((x4&x0)&x5)&(x3)))))|((x0&((x1&((x2&((x4&((x3^x5)^x6))^((x3&(x5))^x5)))^((x7&((x3)^x6))^(((x4&(x5))^(x6&(x3)))))))^((x6&((x4&((x2)^x3))^((((x2)^x3)^x5)^x7)))^((x5&((x4&((x2)^x3))^(x2&(x3^x7))))^((x7&((x3&(x2))))^(x4))))))^((x2&((x1&((x7&((x5)^x6))^((x4&(x6))^((x5)^x6))))^((x6&(((x3)^x4)^x7))^((x7&(x5))^((x4&(x5))^(x3))))))^((x5&((x1&((x3&(x4))^(x6)))^((x7&(x6))^((x4&(x3^x6))^(x3)))))^(x3&((x7&(x6))^(x4&(x6))))))))|((((x7&x1)&x2)&x0)&(x3^x5)))";

inputText = "((((((((((((((((((((((((((((((((((~x1)&(~x0))|((x0&(~x3))^((~x2)^x5)))|((x1&(~x2))^((x0&(~x4))^(~x2))))|(x2&(~x0)))|((((~x2)^x4)|x1)^1))|(x2&(~x4)))|((x3&((~x0)^x1))^((((~x0)^x2)^x4)^x6)))^1)|((x2&((x1&((x0&((x4&(((~x3)^x5)^x6))^((x7&((~x3)^x6))^((~(x3&x5))^x6))))^((x4&(((~x3)^x5)^x6))^((x7&((~x5)^x6))^((~(x3&x5))^x6)))))^((~x0)&((x6&(((~x4)^x5)^x7))^((x7&(~x5))^((x4&(~x3))^(~(x3&x5))))))))^(x5&((x1&((x3&((~x4)&(~x0)))^((~x0)&(~x6))))^((~x4)&((~x3)&(~x0)))))))|((x0&((x4&((x1&((x2&((x3^x5)^x6))^(~x7)))^((x6&((~x2)^x3))^(((~(x2&x3))^x5)^x7))))^((x6&((x1&((~x3)^x5))^((x2&((~x3)^x5))^(~x3))))^((x1&(((x3&x5)&(~x2))^(~x7)))^((x5&(~x2))^(~x7))))))^(x5&((x4&((~x2)&((~x1)^x3)))^((~x2)&((~x3)^(x1&x6)))))))|((x0&((x5&((x4&((x1&((~x2)^x3))^(x2^x3)))^((x3&((~x2)^x6))^((x7&(~x1))^(~(x6&(~x1)))))))^((x2&((x1&((x3&((~x4)^x6))^(~(x4&x6))))^((x3&(~x6))^(x6^x7))))^((x7&(((~x1)^x3)^x4))^(x4&(x1^x3))))))^((x4&((x3&((x1&((~x2)^x5))^((x2&(~x6))^((~x5)^x7))))^((x2&((x1&(~x6))^(x6^x7)))^(x5&(x1^x7)))))^((x5&((x1&((x2^x6)^x7))^((~x3)&((~x2)^x6))))^(x1&((x2&((x7&(~x3))^(~(x3&x6))))^(x3&x7)))))))|((((((x0&(~x2))^((~x3)^x5))|x1)|(x2^x4))|((x2&(~x0))^x6))^1))|((x2&((x4&((x1&((((x0^x3)^x5)^x6)^x7))^((x0&((~x5)^x6))^((x3&(~x6))^(x6^x7)))))^((x0&((x1&((~(x3&x6))^x7))^((~(x5&x6))^x7)))^((x1&x6)&(x3^x5)))))^(x1&((x6&((x3&((~x0)^x4))^((x0&(x4^x5))^x5)))^((x4&x5)&(~(x0&x3)))))))|((x2&((x1&((x0&((x3&((~x5)^x7))^((x4&(~x5))^(x5^x6))))^((x5&(((~x3)^x4)^x6))^((x4&(~x3))^(x6&(~x3))))))^((x6&((x7&((~x0)^x3))^((~x4)&((~x0)^x3))))^((x3&((x5&(~x0))^((~x4)^x7)))^((~x0)&(((~x4)^x5)^x7))))))^(x5&((x4&((~x0)&((~x1)^x3)))^(x6&((~x0)&((~x1)^x3)))))))|((x0&((x4&((x2&((x6&(~x1))^(((~x3)^x5)^x7)))^((x3&(((~(x1&x5))^x6)^x7))^((~x6)^x7))))^((x1&((x7&((~x2)^x3))^((x6&((~x3)^x5))^((~x2)^x3))))^((x2&((x6&((~x3)^x5))^(~x7)))^((~x3)&((~x6)^x7))))))^((x1&x5)&((x4&(~x2))^(x6&(~x2))))))|((x0&((x1&((x2&((x7&(~x3))^(~((x5&(~x3))^(x6&(~x4))))))^((x5&((((~x3)^x4)^x6)^x7))^((x6&((~x3)^x4))^(~x7)))))^((x2&(((x3&((~x4)^x7))^(x5&((~x4)^x6)))^(~x7)))^((x5&((x3&((~x4)^x6))^(~x7)))^((x6&((~x3)^x4))^(~x7))))))^((x1&((x5&((x2&(((~x4)^x6)^x7))^((~x3)&((~x4)^x6))))^((x2&((x3&((~x6)^x7))^(x4&x6)))^((x4&x6)&(~x3)))))^((x4&((~x7)&((~x2)^x3)))^(x5&((~x3)&((~x2)^x7)))))))|((x0&((x1&((x2&((x4&((~x3)^x6))^((x3&(x5^x6))^x5)))^((x3&((~x5)^x7))^((x6&(~x4))^((~x5)^x7)))))^((~x3)&((x2&((x4^x5)^x6))^((x6&(~x4))^((~x5)^x7))))))^((x4&((x1&((x3&(((~x2)^x6)^x7))^((x2&(~x6))^(~x7))))^((x2&((~x3)&(~x6)))^((~x7)&(~x3)))))^((x5&((~x1)&((~x2)&(~x3))))^(((x1&x3)&x6)&(~x2))))))|((x2&((x3&((x4&(((~x0)^x5)^x6))^((x1&((x7&(~x0))^(x0^x5)))^((x6&(~x0))^(~x5)))))^((x7&((x0&(((x1^x4)^x5)^x6))^((x5&(~x1))^(~x6))))^((x0&((x6&(~x5))^(~(x1&x4))))^((x5&(~x1))^(~x6))))))^((x4&((x1&((x0&((x3&(~x5))^(~x6)))^((~x3)^x7)))^((x7&((~x0)^x3))^((x5&((~(x0&x3))^x6))^(~(x6&(x0^x3)))))))^((x3&((x1&((x6&(~x7))^((~x0)^x5)))^((x0&(~x7))^((~x5)^x6))))^((x0&((~x1)&((~x5)^x6)))^((x5&x6)&(~x1)))))))|((x5&((x1&((x3&((x2&(~x0))^((~x0)^x6)))^((~x0)&((~x2)^x6))))^((x4&((~x3)&((~x0)^x2)))^(x6&((x0&(~x2))^(~x3))))))^((x3&x0)&((x1&(((x2^x4)^x6)^x7))^((x2&((~x4)^x7))^(x6&((~x4)^x7)))))))|((x2&((x6&((x0&((x1&(~x3))^(~x4)))^((x5&((~x1)^x4))^(x3&(~x4)))))^((x4&((x1&(x0^x3))^((x0^x3)^x5)))^((~x1)&((x0^x3)^x5)))))^((x4&((x0&((x1&(~(x5&(~x3))))^(~x6)))^((x3&((~x1)^x6))^(x5&(~x6)))))^((x1&((x0&(~(x6&(~x3))))^((x5&(~x6))^x3)))^((~x6)&((x0^x3)^x5))))))|((((((~x5)|x0)|x2)|x3)|x4)^1))|((x0&((x2&((x1&((x3&((~x6)^x7))^((x4&(~x5))^(~x6))))^((x3&(((~x5)^x6)^x7))^((x5&(~x6))^(~x4)))))^((x6&((x1&((~x3)^x5))^((x5&(~x3))^(~x4))))^((x4&(~(x1&(~(x3&x5)))))^((x5&(~x3))^(~x1))))))^((x3&((x2&((x1&(~x6))^(((~x5)^x6)^(x4&x7))))^((x4&((~x1)^x6))^((x5&(~x6))^((~x1)^x6)))))^((x5&((x4&((x1&(~x2))^((~x2)^x6)))^((x1&(~x2))^(x2&x6))))^(((x1&x2)&x6)&(~x4))))))|((((((~x1)|(~x5))|(x0^x2))|(x0^x4))|x3)^1))|((x2&((x0&((x4&((x1&(~x5))^(((x3^x5)^x6)^x7)))^((x5&(((~x3)^x6)^x7))^((x6&((~(x1&x3))^x7))^((x1&x3)&x7)))))^((x1&((x7&((~x5)^x6))^((x3&(x5^x6))^((~x4)^(x5&x6)))))^((x4&((x3&(~x5))^((~x5)^x6)))^((x7&((~x5)^x6))^((~x5)&(~x6)))))))^((x0&((x6&((x3&(((~x1)^x4)^x5))^((x7&(~x1))^(x4^x5))))^(x5&((~x4)&(x1^x3)))))^((x4&((~x7)&(x1^x6)))^(x5&((x1&(~x3))^(x6&(~x3))))))))|((((((((((((~x0)^x1)^x4)|((x1&((x2&(~x0))^x0))^((x3&(~x5))^((~x0)^x5))))|((x2^x3)^x6))|(x3&(~x1)))|(x0&x3))|(x2&x3))|((~x1)&((~x0)^x5)))|(x0&(x1^x5)))|(x2&(((~x0)^x1)^x5)))^1))|((((((~x5)|x0)|x1)|x3)|(x2^x6))^1))|((((((~x1)|x0)|(~x5))|x2)|((~x4)^x6))^1))|((x1&x0)&((x4&((~x3)&(x5^x6)))^((x2&x6)&(~x3)))))|(((((~x5)|(x0^x2))|x3)|((~x4)^x6))^1))|(((x2&x0)&x6)&((~x4)&(~x3))))|(x1&((x6&((x3&((~x2)&((~x0)^x4)))^((x4&x0)&(~x2))))^(((x4&x0)&x5)&(~x3)))))|((x0&((x1&((x2&((x4&((x3^x5)^x6))^((x3&(~x5))^x5)))^((x7&((~x3)^x6))^(~((x4&(~x5))^(x6&(~x3)))))))^((x6&((x4&((~x2)^x3))^((((~x2)^x3)^x5)^x7)))^((x5&((x4&((~x2)^x3))^(x2&(x3^x7))))^((x7&(~(x3&(~x2))))^(~x4))))))^((x2&((x1&((x7&((~x5)^x6))^((x4&(~x6))^((~x5)^x6))))^((x6&(((~x3)^x4)^x7))^((x7&(~x5))^((x4&(~x5))^(~x3))))))^((x5&((x1&((x3&(~x4))^(~x6)))^((x7&(~x6))^((x4&(x3^x6))^(~x3)))))^(x3&((x7&(~x6))^(x4&(~x6))))))))|((((x7&x1)&x2)&x0)&(x3^x5)))";

inputText = "x0|x1|x2|x3";

inputText = "(((((((((x2 & x3) ^ (x1 & x3)) ^ (x0 & x3)) ^ x3) | ((((x3 & x4) ^ (x2 & x4)) ^ (x1 & x4)) ^ (x0 & x4))) | (((((x3 & x5) & x6) ^ ((x2 & x5) & x6)) ^ ((x1 & x5) & x6)) ^ ((x0 & x5) & x6))) | x7) | x8) | x9 | x10 | x11)";

inputText = "a|b|c";

//inputText = "(x0 & ((x1 & ((x6 & ((x2 & ((x3 & ((x4 & (~(x5 & ~x7))) ^ ~x5 ^ x7)) ^ (x4 & x7 & ~x5) ^ ~x5)) ^ (x7 & ~x4 & (~x3 ^ x5)) ^ (x3 & ~x4) ^ (~(x4 & x5)))) ^ (x2 & ((x7 & ((x4 & ~x3 & ~x5) ^ ~x5)) ^ (x3 & ~x4) ^ x5)) ^ (~(x3 & ((x4 & (x5 ^ x7)) ^ ~x5 ^ x7))))) ^ (x7 & ((x2 & ((x5 & (~x3 ^ x4 ^ x6)) ^ (x3 & ~x4) ^ x4 ^ x6)) ^ (x5 & ~x4 & ~x6) ^ (x3 & (~x4 ^ x6)) ^ x6)) ^ (x4 & ((x6 & ((x2 & (~(x3 & ~x5))) ^ ~x3 ^ x5)) ^ (x5 & ~x2))) ^ (x2 & ~x3) ^ ~x3 ^ x5 ^ x6)) ^ (x3 & ((x1 & ((x7 & ((x2 & ((x4 & (~x5 ^ x6)) ^ (~(x5 & ~x6)))) ^ (~x5 & (~x4 ^ x6)))) ^ (x2 & ~x4 & ~x6) ^ (x5 & (~(x6 & ~x4))) ^ ~x4)) ^ (x4 & ((x5 & ((x2 & ~x7) ^ ~x6)) ^ (~(x6 & (~(x2 & x7)))))) ^ (x2 & (~x6 ^ (x5 & x7))) ^ (~(x6 & ~x5)))) ^ (x4 & ((x5 & ((x6 & ~x1 & (~x2 ^ x7)) ^ (~(x7 & ~x2)))) ^ (x2 & ((x7 & (~(x6 & ~x1))) ^ x1)) ^ (~(x1 & x6)) ^ x7)) ^ (x2 & ((x6 & ((x1 & ~x5) ^ ~x7)) ^ (~(x1 & x5)) ^ x7)) ^ x5";

var printHelp = () =>
{
    Console.WriteLine("Usage: Simplifier.exe");
    Console.WriteLine("Command line input not preceded by the option indicators below are considered to be input expressions. Only one input expression is accepted.");
    Console.WriteLine("Command line options:");
    Console.WriteLine("    -h:        print usage");
    Console.WriteLine("    -b:        specify the bit number of variables (default is 64)");
    Console.WriteLine("    -z:        enable a check for valid simplification using Z3");
    Console.WriteLine("    -e:        enable equality saturation based simplification");
};

for (int i = 0; i < args.Length; i++)
{
    var arg = args[i];
    switch (arg)
    {
        case "-h":
            printUsage = true;
            break;
        case "-b":  
            bitWidth = uint.Parse(args[i + 1]);
            i++;
            break;
        case "-z":
            proveEquivalence = true;
            break;
        case "-e":
            useEqsat = true;
            break;
        default:
            if (inputText != null)
                throw new ArgumentException($"Found more than one expression argument. Received both {inputText} and {args[i]}");
            inputText = args[i];
            break;
    }
}

if (inputText == null || printUsage)
{
    printHelp();
    return;
}

// For now we only support integer widths of up to 64 bits.
const int maxWidth = 64;
if (bitWidth > maxWidth)
    throw new InvalidOperationException($"Received bit width {bitWidth}, which is greater than the max width {maxWidth}");

var ctx = new AstCtx();
AstIdx.ctx = ctx;
var id = RustAstParser.Parse(ctx, inputText, bitWidth);

Console.WriteLine($"\nExpression: {ctx.GetAstString(id)}\n\n\n");


var input = id;
id = ctx.RecursiveSimplify(id);
for (int i = 0; i < 3; i++)
{
    // Apply our simplification procedure.
    var simplifier = new GeneralSimplifier(ctx);
    // Run the simplification pipeline.
    id = simplifier.SimplifyGeneral(id);
    // Try to expand and reduce the polynomial parts(if any exist).
    if(ctx.GetHasPoly(id))
        id = simplifier.ExpandReduce(id);

    if (!useEqsat)
        continue;
    if (bitWidth != 64)
        throw new InvalidOperationException($"Equality saturation is only supported for 64-bit expressions");

    // Apply equality saturation.
    ulong timeout = 2000;
    Console.WriteLine($"Running equality saturation with {timeout}ms timeout...");
    var ast = AstParser.Parse(ctx.GetAstString(id), bitWidth);
    var egg = EqualitySaturation.Run(ast, timeout);
    id = RustAstParser.Parse(ctx, egg.ToString(), bitWidth);

    // Apply term rewriting.
    id = ctx.RecursiveSimplify(id);
    Console.WriteLine($"Eqsat run {i} yielded: {ctx.GetAstString(id)}\n\n");
}


Console.WriteLine($"Simplified to: {ctx.GetAstString(id)}\n\nwith cost: {ctx.GetCost(id)}");

if (!proveEquivalence)
    return;

var z3Ctx = new Context();
var translator = new Z3Translator(ctx, z3Ctx);
var before = translator.Translate(input);
var after = translator.Translate(id);
var solver = z3Ctx.MkSolver("QF_BV");

// Set the maximum timeout to 10 seconds.
var p = z3Ctx.MkParams();
uint solverLimit = 10000;
p.Add("timeout", solverLimit);
solver.Parameters = p;

Console.WriteLine("Proving equivalence...\n");
solver.Add(z3Ctx.MkNot(z3Ctx.MkEq(before, after)));
var check = solver.Check();

var printModel = (Model model) =>
{
    var values = model.Consts.Select(x => $"{x.Key.Name} = {(long)ulong.Parse(model.Eval(x.Value).ToString())}");
    return $"[{String.Join(", ", values)}]";
};

if (check == Status.UNSATISFIABLE)
    Console.WriteLine("Expressions are equivalent.");
else if (check == Status.SATISFIABLE)
    Console.WriteLine($"Expressions are not equivalent. Counterexample:\n{printModel(solver.Model)}");
else
    Console.WriteLine($"Solver timed out - expressions are probably equivalent. Could not find counterexample within {solverLimit}ms");